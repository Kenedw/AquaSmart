<!DOCTYPE html>
<html lang="pt"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="pagina de login, usuario e senha">
  <meta name="author" content="Kened Oliveira">

  <title>AquaSmart</title>

  <!-- Bootstrap core CSS -->
  <link href="./text/bootstrap.min.css" rel="stylesheet">
  <link href="./text/bootstrap-toggle.min.css" rel="stylesheet">
  <!-- Custom script -->
  <script src="./text/jquery.min.js"></script>
  <script src="./text/bootstrap.min.js"></script>
  <script src="./text/bootstrap-toggle.min.js"></script>
</head>

<body style="background-color:#f2f2f2;">
  <form class="form" id="form">
    <div class="text-center mb-4">
      <img class="mb-4" src="./image/AquaSmart.png" alt="" width="278" height="200">

      <div class="checkbox">
        <p>
          <button  class="btn btn-outline-info" id="labelT2" type="button">Tomada 1</button>
          <input   type="checkbox" checked data-toggle="toggle" id="t1" name="T1" data-on="Ligado" data-off="Desligado" data-onstyle="success" data-offstyle="danger"onchange="EnviaDados()">
          <button  class="btn btn-info" type="submit">Editar</button>
          <button  class="btn btn-info" type="submit">Agendar</button>
        </p>
      </div>

      <div class="checkbox">
        <p>
          <button  class="btn btn-outline-info" id="labelT2" type="button">Tomada 2</button>
          <input   type="checkbox" checked data-toggle="toggle" id="t2" name="T2" data-on="Ligado" data-off="Desligado" data-onstyle="success" data-offstyle="danger"onchange="EnviaDados()">
          <button  class="btn  btn-info" type="submit">Editar</button>
          <button  class="btn btn-info" type="submit">Agendar</button>
        </p>
      </div>

      <div class="checkbox">
        <p>
          <button  class="btn btn-outline-info" id="labelT3" type="button">Tomada 3</button>
          <input   type="checkbox" checked data-toggle="toggle" id="t3" name="T3" data-on="Ligado" data-off="Desligado" data-onstyle="success" data-offstyle="danger"onchange="EnviaDados()">
          <button  class="btn btn-info " type="submit">Editar</button>
          <button  class="btn btn-info" type="submit">Agendar</button>
        </p>
      </div>

      <div class="checkbox">
        <p>
          <button  class="btn btn-outline-info" type="button" id="labelT4">Tomada 4</button>
          <input   type="checkbox" checked data-toggle="toggle"  id="t4"name="T4" data-on="Ligado" data-off="Desligado" data-onstyle="success" data-offstyle="danger" onchange="EnviaDados()">
          <button  class="btn  btn-info" type="submit">Editar</button>
          <button  class="btn btn-info" type="submit">Agendar</button>
        </p>
      </div>

      <!-- usar  para o botão de editar -->
      <div class="label-primary">
        <a class="btn btn-primary btn-lg" href="/apagaTudo">Desligar Tudo</a>
        <button  type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#confirm" >Resetar ESP</button>
        <div class="modal fade" id="confirm" role="dialog">
          <div class="modal-dialog modal-md">
            <div class="modal-content">
              <div class="modal-body"><p> QUER REALMENTE FAZER ISSO?? NÂO POR FAVOR, EU TENHO FILHOS!!</p>
              </div>
              <div class="modal-footer">
                <a href="/resetwifi" class="btn btn-danger">Sim</a>
                <button type="button" data-dismiss="modal" class="btn btn-default">Cancelar</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <p class="mt-5 mb-3 text-muted text-center">© 2017-2018</p>
    </form>

    <script>
    function newXmlHttpRequest() {
      if (window.XMLHttpRequest) {
        return new XMLHttpRequest();
      } else if (window.ActiveXObject) {
        return new ActiveXObject("Microsoft.XMLHTTP");
      }
    }

    $(function() {
      $('#t2').change(function() {
        if ($('#t2').prop('checked')) {
          $('#t3').bootstrapToggle('on')
        }
        else {
          $('#t3').bootstrapToggle('off')
        }
      })
    })


    function EnviaDados(){
      var xmlhttp = newXmlHttpRequest();
      var dados = 't1=' + document.getElementById('t1').checked + "&t2=" + document.getElementById('t2').checked + "&t3=" + document.getElementById('t3').checked + "&t4=" + document.getElementById('t4').checked;
      xmlhttp.onreadystatechange = function(){
        if (xmlhttp.readyState==4 && (xmlhttp.status == 200)) {
          // var Recebe = xmlhttp.responseText.toString();
          // var resposta = xmlhttp.responseText;//document.getElementById("Resposta_da_ESP").innerHTML = xmlhttp.responseText;
        }
      }
      xmlhttp.open("GET", 'setTomadas?' + dados, true);
      xmlhttp.send();
    }

    setInterval(function() {
      // Call a function repetatively with 10 Second interval
      getData();
    }, 10000); //10000mSeconds update rate

    function getData() {
      var xhttp = newXmlHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          var resposta = xmlhttp.responseText;//document.getElementById("Resposta_da_ESP").innerHTML = xmlhttp.responseText;
        }
      };
      xhttp.open("GET", "callback", true);
      xhttp.send();
    }

  </script>
</body></html>
